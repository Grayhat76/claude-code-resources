# Project: [Your Project Name]

<!-- 
  CLAUDE.md - Your Project's AI Context
  This file helps Claude Code understand your project.
  Update this as your project evolves.
  
  TIP: Keep this file under 500 lines for best results.
  For longer documentation, split into multiple files and import them:
  @.claude/architecture.md
  @.claude/api-docs.md
-->

---

## Project Overview

<!-- Brief description (2-3 sentences) -->
[Your app name] is a [type of application] that [main purpose].

**Status**: [In Development / Production / MVP]  
**Team**: [Solo / Team of X]  
**Deployment**: [Where deployed - Vercel, AWS, etc.]

---

## Tech Stack

### Core Technologies
- **Framework**: [Next.js 14, Express, Django, etc.]
- **Language**: [TypeScript, Python, etc.]
- **Database**: [PostgreSQL, MongoDB, etc.]
- **ORM/Query Builder**: [Prisma, Drizzle, SQLAlchemy, etc.]
- **Styling**: [Tailwind CSS, Styled Components, etc.]
- **State Management**: [Zustand, Redux, Context API, etc.]

### Infrastructure
- **Hosting**: [Vercel, AWS, Railway, etc.]
- **Database Hosting**: [Supabase, PlanetScale, RDS, etc.]
- **Cache**: [Redis, Upstash, etc.]
- **File Storage**: [S3, Cloudflare R2, etc.]
- **Auth**: [NextAuth, Clerk, Supabase Auth, etc.]

### Development
- **Testing**: [Jest, Vitest, Pytest, etc.]
- **Linting**: [ESLint, Prettier, Ruff, etc.]
- **Type Checking**: [TypeScript, Pydantic, etc.]
- **Build Tool**: [Vite, Webpack, esbuild, etc.]

### Notable Dependencies
- [List key dependencies and why they're important]
- [Example: `react-hook-form` - All forms use this]
- [Example: `zod` - Runtime validation everywhere]

---

## Project Structure

```
src/
├── app/                    # Next.js app directory
│   ├── api/               # API routes
│   ├── (auth)/            # Auth route group
│   └── (dashboard)/       # Dashboard route group
├── components/
│   ├── ui/                # Shadcn/ui components
│   ├── features/          # Feature-specific components
│   └── layouts/           # Layout components
├── lib/
│   ├── db/                # Database utilities
│   ├── auth/              # Auth utilities
│   ├── api/               # API client
│   └── utils/             # General utilities
├── hooks/                 # Custom React hooks
├── types/                 # TypeScript type definitions
└── styles/                # Global styles

[Adjust based on your framework]
```

### Key Directories Explained
- **`app/api/`**: [Explanation of API route organization]
- **`components/features/`**: [Feature-based component organization]
- **`lib/`**: [Shared utilities and configurations]

---

## Code Standards

### File Naming Conventions

**Components**
- React Components: `PascalCase.tsx`
- Vue Components: `PascalCase.vue`
- Example: `UserProfile.tsx`, `DashboardLayout.tsx`

**Utilities & Hooks**
- Utilities: `camelCase.ts`
- Hooks: `camelCase.ts` with "use" prefix
- Example: `formatDate.ts`, `useUserData.ts`

**Types**
- Type Files: `PascalCase.types.ts`
- Example: `User.types.ts`, `ApiResponse.types.ts`

**Tests**
- Test Files: `[filename].test.ts(x)`
- Example: `UserProfile.test.tsx`, `formatDate.test.ts`

### TypeScript Guidelines

```typescript
// ✅ DO: Use interfaces for objects
interface UserProps {
  name: string;
  email: string;
}

// ✅ DO: Props interface directly above component
interface ButtonProps {
  variant: 'primary' | 'secondary';
  children: React.ReactNode;
}

export function Button({ variant, children }: ButtonProps) {
  // Component implementation
}

// ✅ DO: Use const assertions for literal types
const USER_ROLES = ['admin', 'user', 'guest'] as const;

// ❌ DON'T: Use 'any' type
// Instead use 'unknown' or proper types

// ❌ DON'T: Mix interfaces and types randomly
// Pick one pattern and stick to it
```

### Component Guidelines

```typescript
// ✅ DO: Functional components only
export function UserCard({ user }: UserCardProps) {
  const [isExpanded, setIsExpanded] = useState(false);
  return (/* ... */);
}

// ❌ DON'T: Class components
// We don't use class components in this project

// ✅ DO: Keep components under 150 lines
// If larger, extract sub-components or hooks

// ✅ DO: Co-locate related files
UserCard/
├── UserCard.tsx
├── UserCard.test.tsx
├── UserCard.types.ts
└── useUserCard.ts
```

### Import Organization

```typescript
// ✅ DO: Organize imports in this order:
// 1. React/framework imports
import { useState, useEffect } from 'react';

// 2. Third-party imports
import { z } from 'zod';
import { motion } from 'framer-motion';

// 3. Internal imports (absolute)
import { Button } from '@/components/ui/button';
import { useAuth } from '@/hooks/useAuth';

// 4. Relative imports
import { UserCard } from './UserCard';

// 5. Types (separate)
import type { User } from '@/types';
```

### API Design

**Endpoints**
```
✅ DO:
GET    /api/users
GET    /api/users/:id
POST   /api/users
PATCH  /api/users/:id
DELETE /api/users/:id

❌ DON'T:
/api/getUsers
/api/createUser
/api/deleteUser
```

**Response Format**
```typescript
// ✅ DO: Use consistent response envelope
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
    details?: unknown;
  };
  meta?: {
    timestamp: string;
    requestId: string;
  };
}
```

### Error Handling

```typescript
// ✅ DO: Use custom error classes
class ValidationError extends Error {
  constructor(message: string, public details?: unknown) {
    super(message);
    this.name = 'ValidationError';
  }
}

// ✅ DO: Handle errors at boundaries
try {
  await riskyOperation();
} catch (error) {
  if (error instanceof ValidationError) {
    // Handle validation errors
  }
  // Log and rethrow or handle gracefully
  logger.error(error);
  throw error;
}
```

### Database Conventions

```typescript
// ✅ DO: Use Prisma schema naming
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ✅ DO: Include audit fields
// createdAt, updatedAt on all models

// ✅ DO: Use appropriate indexes
@@index([email])
@@index([createdAt])
```

---

## Testing Standards

### Testing Approach
- **Unit Tests**: All utility functions and hooks
- **Integration Tests**: All API endpoints
- **E2E Tests**: Critical user flows only

### Coverage Requirements
- **Utilities**: 100% coverage
- **Components**: 80% coverage
- **API Routes**: 90% coverage
- **Overall**: Minimum 80% coverage

### Test Structure
```typescript
describe('UserCard', () => {
  // ✅ DO: Use describe blocks for organization
  describe('when user is authenticated', () => {
    it('should display user information', () => {
      // Arrange
      const user = mockUser();
      
      // Act
      render(<UserCard user={user} />);
      
      // Assert
      expect(screen.getByText(user.name)).toBeInTheDocument();
    });
  });
});
```

---

## Development Workflow

### Before Making Changes
1. **Read existing code** to understand patterns
2. **Check for similar implementations** to maintain consistency
3. **Create a plan** for complex features
4. **Write tests first** for new functionality (TDD when possible)

### During Development
1. **Make small, focused commits**
2. **Run tests continuously** (`npm run test:watch`)
3. **Format code** before committing (`npm run format`)
4. **Type-check** regularly (`npm run type-check`)

### After Changes
1. **Run full test suite** (`npm test`)
2. **Build locally** to catch build errors (`npm run build`)
3. **Update documentation** if behavior changed
4. **Self-review** diff before committing

---

## Available Commands

### Development
```bash
npm run dev           # Start development server (localhost:3000)
npm run dev:debug     # Start with debugging enabled
npm run studio        # Open Prisma Studio (database GUI)
```

### Testing
```bash
npm test              # Run all tests
npm run test:watch    # Run tests in watch mode
npm run test:coverage # Generate coverage report
npm run test:e2e      # Run E2E tests (requires dev server)
```

### Building
```bash
npm run build         # Production build
npm run start         # Start production server
npm run build:analyze # Analyze bundle size
```

### Database
```bash
npx prisma generate        # Generate Prisma Client
npx prisma migrate dev     # Create and apply migration
npx prisma migrate deploy  # Apply migrations (production)
npx prisma db push         # Push schema without migration
npx prisma db seed         # Seed database
```

### Code Quality
```bash
npm run lint          # Run ESLint
npm run lint:fix      # Fix auto-fixable issues
npm run format        # Format with Prettier
npm run type-check    # TypeScript type checking
```

---

## Important Patterns & Conventions

### Authentication
- All protected routes use `middleware.ts`
- Session stored in httpOnly cookie
- JWT tokens expire in 7 days
- Refresh tokens stored in database

### API Routes
- All routes return standardized ApiResponse
- Use Zod for input validation
- Error codes follow format: `CATEGORY_NUMBER`
  - `AUTH_001`: Invalid credentials
  - `VAL_001`: Validation error
  - `DB_001`: Database error

### State Management
- Server state: React Query (TanStack Query)
- Client state: Zustand stores
- Form state: React Hook Form
- URL state: Next.js router

### Styling
- Use Tailwind utility classes
- Custom components in `components/ui/`
- Dark mode via next-themes
- Responsive: mobile-first approach

---

## Current Context

### Current Sprint/Focus
<!-- Update this regularly -->
**Current**: Building user authentication system  
**Next Up**: Dashboard with analytics  
**Backlog**: Payment integration

### Recent Major Changes
<!-- Keep last 3-5 significant changes -->
- [Date]: Migrated from Pages Router to App Router
- [Date]: Switched from REST to tRPC
- [Date]: Implemented new design system

### Known Issues
<!-- Document current bugs or limitations -->
- [ ] Email verification sometimes delayed
- [ ] Dark mode flickers on page load
- [ ] File upload limited to 10MB (by design)

### Technical Debt
<!-- Track what needs refactoring -->
- [ ] Refactor auth middleware (too complex)
- [ ] Extract shared API logic to utilities
- [ ] Update deprecated dependencies

---

## Security Considerations

### Never Commit
- `.env` files (add to .gitignore)
- API keys or secrets
- Database credentials
- Private keys

### Security Rules
- Always validate user input
- Sanitize data before database operations
- Use parameterized queries (Prisma does this)
- Never trust client-side data
- Rate limit public endpoints
- Use HTTPS in production

### Authentication
- Passwords hashed with bcrypt (cost: 10)
- JWT secrets in environment variables
- Implement CSRF protection
- Use secure session cookies

---

## Performance Considerations

### Core Web Vitals Targets
- **LCP**: < 2.5s
- **FID**: < 100ms
- **CLS**: < 0.1

### Optimization Guidelines
- Use Next.js Image component for all images
- Lazy load below-the-fold components
- Implement infinite scroll for large lists
- Cache API responses with React Query
- Use dynamic imports for code splitting

---

## Deployment

### Environments
- **Development**: localhost:3000
- **Preview**: [Vercel preview URLs]
- **Production**: [your-production-url.com]

### Environment Variables Required
```bash
# Database
DATABASE_URL=

# Authentication
NEXTAUTH_SECRET=
NEXTAUTH_URL=

# API Keys
STRIPE_SECRET_KEY=
SENDGRID_API_KEY=

# [Add your required env vars]
```

### Deployment Checklist
- [ ] All tests passing
- [ ] Build succeeds locally
- [ ] Environment variables configured
- [ ] Database migrations applied
- [ ] No console errors in production build

---

## Team Conventions

<!-- Customize this section for your team -->

### Code Review Standards
- All PRs require 2 approvals
- Tests must pass CI
- No console.logs in production code
- Must update CLAUDE.md if patterns change

### Branch Naming
```
feature/add-user-authentication
bugfix/fix-login-redirect
hotfix/critical-payment-issue
refactor/simplify-api-layer
```

### Commit Messages
```
feat: add user authentication
fix: resolve login redirect issue
docs: update API documentation
refactor: simplify database queries
test: add integration tests for auth
```

---

## Additional Resources

### Internal Documentation
- Architecture Diagrams: [Link or @.claude/architecture.md]
- API Documentation: [Link or @.claude/api-docs.md]
- Database Schema: [Link or @.claude/database-schema.md]
- Design System: [Figma link or @.claude/design-system.md]

### External Resources
- [Framework Documentation]
- [Key Library Documentation]
- [Team Wiki/Notion]

---

## Import Additional Context

<!-- Use @ syntax to import other markdown files -->
<!-- These files will be loaded when Claude Code starts -->

@.claude/architecture.md
@.claude/api-conventions.md
@.claude/database-schema.md

<!-- Create separate files for:
  - Detailed architecture
  - API conventions and endpoints
  - Database schema and relationships
  - Deployment procedures
  - Team-specific guidelines
-->

---

## Notes for Claude Code

<!-- Specific instructions for Claude when working on this project -->

### When Creating New Features
1. Always check CLAUDE.md for patterns first
2. Create tests before implementation
3. Follow the project structure exactly
4. Use existing utilities instead of reinventing
5. Match the code style of surrounding files

### When Refactoring
1. Ensure all tests pass before starting
2. Make changes incrementally
3. Keep tests passing throughout
4. Update documentation if behavior changes

### When Reviewing Code
1. Check for security issues first
2. Verify tests are comprehensive
3. Ensure code follows project patterns
4. Confirm no hardcoded secrets
5. Validate error handling

---

**Last Updated**: [Date]  
**Maintained By**: [Your name/team]  
**Version**: [Semantic version]

<!-- 
  MAINTENANCE TIPS:
  - Update this after major architectural changes
  - Review monthly for accuracy
  - Keep under 500 lines (split if longer)
  - Version control this file
  - Share updates with team
-->
